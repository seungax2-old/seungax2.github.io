<!DOCTYPE html>
<html lang="en" >

<head>
<meta charset="UTF-8">
  
<link rel="stylesheet" href="resources/app_style.css">
<script  src="resources/jquery-1.12.3.js"></script>

  
</head>

<body>
    
<div class="event">
    <div class="img"><img src="resources/main_01.png"/></div>
    <div class="img gameStartWrap" style="display: none;">
        <!--타이머-->
        <div class="img">
            <img src="resources/main_02.png"/>
            <div class="flex centerH timerWrap">
                <!--<p>00</p>
                <p style="margin: 0 2vw;"> : </p>-->
                <p><img class="clock_Img" src="resources/clock_off.png"/></p>
                <p class="Second">19</p>
            </div>
        </div>
        <div class="img">
            <img src="resources/main_03.png"/>
            <div class="flex centerH chanceWrap">
                <p class="pig_chance3"><img src="resources/pig_on.png"/></p>
                <p class="pig_chance2"><img src="resources/pig_on.png"/></p>
                <p class="pig_chance1"><img src="resources/pig_on.png"/></p>
            </div>
        </div>
        <div class="img">
            <img src="resources/main_04.png"/>
            <!--이미지 위-->
            <div class="findWrap">
                <div class="find_imgWrap getPosition">
                    <img class="topImg" src="" />
                    <p class="dft_pointX" style="display: none;"><img src="resources/x_icon.png"/></p>
                    <p class="dft_point0 pointChk"><img class="point_icon" src="resources/dft_point_chk.png"/></p>
                    <p class="dft_point1 pointChk"><img class="point_icon" src="resources/dft_point_chk.png"/></p>
                    <p class="dft_point2 pointChk"><img class="point_icon" src="resources/dft_point_chk.png"/></p>
                </div>
            </div>
            <!--//이미지 위-->
        </div>
        <div class="img margin_t20">
            <img src="resources/main_05.png"/>
            <!--이미지 아래-->
            <div class="findWrap">
                <div class="find_imgWrap">
                    <img class="btmImg" src="" />
                    <p class="dft_pointX" style="display: none;"><img src="resources/x_icon.png"/></p>
                    <p class="dft_point0 pointChk"><img class="point_icon" src="resources/dft_point_chk.png"/></p>
                    <p class="dft_point1 pointChk"><img class="point_icon" src="resources/dft_point_chk.png"/></p>
                    <p class="dft_point2 pointChk"><img class="point_icon" src="resources/dft_point_chk.png"/></p>
                </div>
            </div>
            <!--//이미지 아래-->
        </div>
    </div>
    <div class="img startGamebtn_wrap">
        <a class="startGame_btn"></a>
        <img src="resources/gameStart_btn_bg.png"/>
    </div>
    <div class="img"><img src="resources/main_06.png"/></div>
</div>

<script>
    
    var Pointxy = {
        "20190124": [{"left":"46.3%", "top":"2%"},{"left":"59.4%", "top":"33.7%"},{"left":"39.7%", "top":"84.2%"}],
        "20190125": [{"left":"64.8%", "top":"7.5%"},{"left":"16.4%", "top":"57.7%"},{"left":"77.7%", "top":"82.2%"}],
        "20190126": [{"left":"46.8%", "top":"31.5%"},{"left":"31.5%", "top":"80.7%"},{"left":"55.7%", "top":"76.2%"}],
        "20190127": [{"left":"14.8%", "top":"24.5%"},{"left":"17.4%", "top":"70.7%"},{"left":"61.7%", "top":"26.2%"}],
        "20190128": [{"left":"53.8%", "top":"36.5%"},{"left":"50%", "top":"80.3%"},{"left":"59.8%", "top":"25.2%"}],
        "20190129": [{"left":"69.8%", "top":"67.3%"},{"left":"6%", "top":"60.3%"},{"left":"37.3%", "top":"82.5%"}],
        "20190130": [{"left":"91.5%", "top":"81.3%"},{"left":"91%", "top":"13.3%"},{"left":"18.3%", "top":"58.5%"}],
        "20190131": [{"left":"66.3%", "top":"17.3%"},{"left":"16.1%", "top":"29.3%"},{"left":"42.2%", "top":"83.3%"}],
        "20190201": [{"left":"53.8%", "top":"42.3%"},{"left":"19.1%", "top":"74.3%"},{"left":"73.2%", "top":"67.3%"}],
        "20190202": [{"left":"64.3%", "top":"14.3%"},{"left":"49.7%", "top":"72.8%"},{"left":"20.3%", "top":"61.3%"}],
        "20190203": [{"left":"15.1%", "top":"23.3%"},{"left":"80.7%", "top":"72.8%"},{"left":"50.7%", "top":"23.3%"}],
        "20190204": [{"left":"12.1%", "top":"22.4%"},{"left":"86.7%", "top":"9.8%"},{"left":"57.3%", "top":"34.3%"}],
        "20190205": [{"left":"15.1%", "top":"67.4%"},{"left":"79.6%", "top":"9.8%"},{"left":"58%", "top":"26.7%"}]
    }          
    var $topImg = $(".findWrap .find_imgWrap .topImg");
    var $btmImg = $(".findWrap .find_imgWrap .btmImg");
    var timer;
    /*좌표찍기위한 포인트 변수*/
    var $pointChk;
    /*좌표 다찍어진 요소 셀렉터*/
    var $findPoint = $(".pointChk");
    var $pointRelativeWrap = $(".find_imgWrap.getPosition");
    var $wrong_answerWrap = $(".find_imgWrap").children().not(".pointChk");
    var $gameStartWrap = $(".gameStartWrap");
    var $startGame = $(".startGamebtn_wrap");
    var $point_ic = $(".point_icon");
    var $point_ic_x = $(".dft_pointX");
    
    var offsetX = $pointRelativeWrap.offset().left;
    var offsetY = $pointRelativeWrap.offset().top;
    var dft_pointXW, dft_pointXH;
    
    var ic_x, ic_y ;
    $(document).ready(function(){
        
        /*날짜에 맞는 이미지 세팅*/
        var strDate = new Date();
        var yyyy = strDate.getFullYear();
        var mm = (strDate.getMonth() + 1 >= 10 ? '' : '0') + (strDate.getMonth() + 1);
        var dd = (strDate.getDate() >= 10 ? '' : '0') + strDate.getDate();
        /*var today = yyyy + '' + mm + '' + dd;*/
        var today = 20190202;

        console.log("today::"+today);
        $topImg.attr("src","resources/"+ today +"_1.png");
        $btmImg.attr("src","resources/"+ today +"_2.png");
        
        /*해당 이미지에 대한 틀린부분 좌표 세팅*/
        $(Pointxy[today]).each(function(i, member) {
            $pointChk = $(".dft_point"+i).css({"left":Pointxy[today][i].left,"top":Pointxy[today][i].top});
        });
        /*$.getJSON('resources/point_xy.json', function(data) {
            $(data[today]).each(function(i, member) {
                $pointChk = $(".dft_point"+i).css({"left":data[today][i].left,"top":data[today][i].top});
            });
        });
        */
        
        
        /* 정답 맞는데 눌렀을때 = 틀린부분 찾아서 정답 클릭시 복주머니 보여주기 **위아래 이미지 어디를 눌러도 상관 x */
        var right_answerCount = 0;
        $findPoint.on("click",function(){
            var $this = $(this);
            if($this.hasClass("find_check")){
                /*이미 클릭한 정답*/
            }else{
                var hasClass = $(this).attr("class").split(" ")[0];
                $("."+hasClass).addClass("find_check");
                right_answerCount += 1;
            }
            
            if(right_answerCount == 3){
                $findPoint.off("click");
                $wrong_answerWrap.off("click");
                /*alert("당츠엄!!");*/
                gameResult("success");
            }
        });
        
        /* 정답 아닌부분 찾았을시 = 기회는 단 3버언!*/
        var wrong_answerCount = 0;
        $wrong_answerWrap.on("click",function(e){
            dft_pointXW = $point_ic_x.width()*0.5;
            dft_pointXH = $point_ic_x.height()*0.5;
            wrong_answerCount += 1;
            ic_x = e.pageX-dft_pointXW;
            ic_y = (e.pageY-$(this).parent().offset().top)-dft_pointXH;
            $point_ic_x.css({"left":ic_x, "top":ic_y});
            $point_ic_x.show();
            setTimeout(function() {
                $point_ic_x.hide();
            },500);
            
            $(".pig_chance"+wrong_answerCount+" img").attr("src","resources/pig_off.png");
            /*console.log("오답!:::::"+wrong_answerCount);*/
            if(wrong_answerCount == 3){
                $findPoint.off("click");
                $wrong_answerWrap.off("click");
                /*alert("땡탈락!! :: 3번기회 소진");*/
                gameResult("fail");
            }
        })
        
        /*타이머*/
        var setTime = 19;
        var timeresult = "pass";
        var $secondWrap = $(".timerWrap .Second");
        $(".startGame_btn").on("click",function(){
            $startGame.hide();
            $gameStartWrap.show();
            timer = setInterval(function(){
                setTime = setTime-1;
                if(setTime < 10){
                    setTime = "0"+setTime;
                }
                $secondWrap.html(setTime);
                if(setTime == 0){
                    clearInterval(timer);
                    $findPoint.off("click");
                    $wrong_answerWrap.off("click");
                    /*alert("땡탈락!! :: 타임아웃");*/
                    timeresult="fail";
                }else if(setTime < 11){
                    $(".timerWrap p").css("color","#ff8e8e");
                    $(".clock_Img").attr("src","resources/clock_on.png")
                }
            }, 1000);
            /*결과 확인 함수*/
            setTimeout(function() {
                if(timeresult != "pass"){
                    gameResult(timeresult);   
                }
            },19100);
        });
       
        
    });
    
    /*결과처리함수*/
    function gameResult(result){
        if(result == "fail"){
            alert("땡탈락!!");
            clearInterval(timer);
            /*팝업띄우고, 갔다 오면*/
            $point_ic.attr("src","resources/o_icon.png");
            $findPoint.addClass("find_check");
        }else{
            alert("당츠엄!!");
            clearInterval(timer);
        }
    }
</script>
</body>

</html>
